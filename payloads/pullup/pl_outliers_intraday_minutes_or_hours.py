# pylint: disable-msg=import-error
from utils.constants import (
    PROD_AGENT_ID,
    PROD_AGENT_UUID,
)

CONNECTION = "APPROVED_DB2_UP"
OUTLIERS_DAY_BY_HOUR_DATASET = "AUTO_OUTLIERS_DAYBYHOUR"
BACK_RUN = 0
RUN_DATE = "2018-01-11"
QUERY = "select * from OWLDB2.NYSE_STOCKS where TRADE_DATE = '${rd}' "
COLUMN = "TRADE_DATE"

OUTLIERS_DAY_BY_HOUR_PAYLOAD = {
    "dataset": OUTLIERS_DAY_BY_HOUR_DATASET,
    "runId": RUN_DATE,
    "runState": "DRAFT",
    "passFail": 1,
    "passFailLimit": 75,
    "hootOnly": False,
    "parallel": False,
    "plan": False,
    "dataPreviewOff": False,
    "datasetSafeOff": False,
    "obslimit": 300,
    "host": "10.64.2.3:5432/rc202306?currentSchema=validation",
    "user": "anonymous : use -owluser",
    "schemaScore": 1.0,
    "keyDelimiter": "~~",
    "agentId": {"id": PROD_AGENT_ID, "uuid": PROD_AGENT_UUID},
    "load": {
        "dataset": OUTLIERS_DAY_BY_HOUR_DATASET,
        "query": QUERY,
        "operator": "=",
        "dateColumn": COLUMN,
        "sample": 1.0,
        "backRun": BACK_RUN,
        "backRunBin": "DAY",
        "cache": True,
        "dateFormat": "yyyy-MM-dd",
        "timeFormat": "HH:mm:ss.SSS",
        "checkHeader": True,
        "inferSchema": True,
        "delimiter": ",",
        "fileCharSet": "UTF-8",
        "flatten": False,
        "handleMaps": False,
        "handleMixedJson": False,
        "multiLine": False,
        "lib": "/opt/owl/drivers/db2/",
        "driverName": "com.ibm.db2.jcc.DB2Driver",
        "connectionName": CONNECTION,
        "connectionUrl": "jdbc:db2://10.150.0.3:50000/owldb2",
        "userName": "db2test",
        "useSql": True,
        "numPartitions": 0,
        "escapeWithBackTick": False,
        "escapeWithSingleQuote": False,
        "escapeWithDoubleQuote": False,
        "partitionNumber": 0,
        "archiveBreaks": False,
        "hasHeader": True,
    },
    "outliers": [
        {
            "id": 342,
            "on": True,
            "only": False,
            "key": None,
            "lookback": 5,
            "include": [
                "CLOSE",
                "EXCH",
                "HIGH",
                "LOW",
                "OPEN",
                "SYMBOL",
                "TRADE_DATE",
                "VOLUME",
            ],
            "exclude": ["PART_DATE_STR"],
            "dateColumn": "TRADE_DATE",
            "timeBin": "DAY",
            "categorical": False,
            "by": "HOUR",
            "limit": 300,
            "minHistory": 3,
            "historyLimit": 5,
            "score": 1.0,
            "q1": 0.15,
            "q3": 0.85,
            "categoricalColumnConcatenation": False,
            "multiplierUpper": 1.35,
            "multiplierLower": 1.35,
            "record": True,
            "combine": True,
            "categoricalTopN": 3,
            "categoricalBottomN": 2,
            "categoricalMaxConfidence": 0.02,
            "categoricalMaxFrequencyPercentile": 0.25,
            "categoricalMinFrequency": 1,
            "categoricalMinVariance": 0.0,
            "categoricalMaxCategoryN": 1,
            "categoricalParallel": True,
        }
    ],
    "outlier": {
        "id": None,
        "on": False,
        "only": False,
        "lookback": 5,
        "timeBin": "DAY",
        "categorical": True,
        "limit": 300,
        "minHistory": 3,
        "historyLimit": 5,
        "score": 1.0,
        "q1": 0.15,
        "q3": 0.85,
        "categoricalColumnConcatenation": False,
        "multiplierUpper": 1.35,
        "multiplierLower": 1.35,
        "record": True,
        "combine": True,
        "categoricalTopN": 3,
        "categoricalBottomN": 2,
        "categoricalMaxConfidence": 0.02,
        "categoricalMaxFrequencyPercentile": 0.25,
        "categoricalMinFrequency": 1,
        "categoricalMinVariance": 0.0,
        "categoricalMaxCategoryN": 1,
        "categoricalParallel": True,
    },
    "pattern": {
        "id": None,
        "only": False,
        "lookback": 5,
        "key": None,
        "score": 1.0,
        "minSupport": 3.3e-5,
        "confidence": 0.6,
        "limit": 30,
        "timeBin": "DAY",
        "on": False,
        "match": True,
        "lowFreq": False,
        "bucketLimit": 450000,
        "deDupe": True,
    },
    "dupe": {"dataset": None, "on": False, "only": False},
    "profile": {
        "dataset": OUTLIERS_DAY_BY_HOUR_DATASET,
        "on": True,
        "only": False,
        "shape": False,
        "limit": 300,
        "histogramLimit": 0,
        "score": 1.0,
        "shapeTotalScore": 0,
        "shapeSensitivity": 0.0,
        "shapeMaxPerCol": 0,
        "shapeMaxColSize": 0,
        "behaviorScoreOff": False,
        "behaviorLookback": 10,
        "behaviorMinSupport": 4,
        "behaviorRowCheck": True,
        "behaviorTimeCheck": False,
        "behaviorMinValueCheck": False,
        "behaviorMaxValueCheck": False,
        "behaviorMeanValueCheck": False,
        "behaviorNullCheck": True,
        "behaviorEmptyCheck": True,
        "behaviorUniqueCheck": True,
        "profileStringLength": False,
    },
    "source": {
        "on": False,
        "only": False,
        "validateValues": False,
        "key": None,
    },
    "rule": {
        "on": True,
        "only": False,
        "lib": None,
        "absoluteScoring": False,
        "ruleBreakPreviewLimit": 6,
    },
    "colMatch": {
        "dataset": OUTLIERS_DAY_BY_HOUR_DATASET,
        "colMatchParallelProcesses": 3,
        "colMatchDurationMins": 20,
        "colMatchBatchSize": 2,
        "level": "exact",
        "fuzzyDistance": 1,
    },
    "spark": {
        "dataset": OUTLIERS_DAY_BY_HOUR_DATASET,
        "numExecutors": 1,
        "driverMemory": "1g",
        "executorMemory": "2g",
        "executorCores": 1,
        "conf": "",
        "queue": "",
        "master": "k8s://",
        "principal": "",
        "keyTab": "",
        "deployMode": "cluster",
    },
}
