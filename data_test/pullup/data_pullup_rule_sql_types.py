# pylint: disable-msg=anomalous-backslash-in-string
# Note: The regex in some rules triggers the backslash error, so disabled.

# !!!
# NOTE!! Some data uses "null" so don't find/replace.
# !!!

from utils.constants import PROD_RUN_ID, BASE_CREDS

CONNECTION_SQL_TYPE = "APPROVED_ORACLE_UP"
PULLUP_RULES_SQL_TYPES_DATASET = "AUTO_RULES_SQLTYPE_2"  # Not unique err, will this happen again?
QUERY_SQL_TYPE = "select * from OWLUSER.LOAN_CUSTOMER"
FULL_RUN_ID_SQL_TYPE = f"{PROD_RUN_ID}T00:00:00.000+0000"

CONN_NAME_PWDMGR = "APPROVED_POSTGRES_PWDMGR"
PULLUP_RULES_PWDMGR_ALL_RULE_TYPES_DATASET = "AUTO_RULE_PG_PWDMGR"
WHERE_DATE_PWDMGR = "2021-12-15"
FULL_RUN_ID_SQL_TYPE_PWDMGR = f"{WHERE_DATE_PWDMGR}T00:00:00.000+0000"
PWD_CMD_LINE = (
    "-conf spark.kubernetes.executor.podTemplateFile=local:///opt/owl/owlcheck-logs/"
    "k8s-executor-template.yml,spark.executorEnv.ALLOWED_LOCAL_PATHS=/tmp/keytab,"
    "spark.kubernetes.driver.podTemplateFile=local:///opt/owl/owlcheck-logs/"
    "k8s-driver-template.yml,spark.kubernetes.driverEnv.ALLOWED_LOCAL_PATHS=/tmp/keytab"
)

# List of rules to add. Note parameters vary depending on the rule type.
PULLUP_RULES_SQL_TYPES_RULE_DEFINITIONS = [
    {
        "dataset": PULLUP_RULES_SQL_TYPES_DATASET,
        "ruleNm": "if_ADJ_RATE_CHANGE_is_EMPTYCHECK",
        "ruleType": "EMPTYCHECK",
        "ruleValue": "ADJ_RATE_CHANGE",
        "points": 1,
        "perc": 1.0,
        "ruleRepo": "",
        "isActive": 1,
        "userNm": None,
        "exception": None,
        "columnName": "ADJ_RATE_CHANGE",
        "businessCategory": None,
        "businessDesc": None,
        "dimId": None,
        "dimName": None,
        "ruleValueBuilder": None,
        "previewLimit": 6,
        "runTimeLimit": 30.0,
        "scoringScheme": 0,
        "filterQuery": None,
        "tolerance": 0,
        "active": True
    },
    {
        "dataset": PULLUP_RULES_SQL_TYPES_DATASET,
        "ruleNm": "if_ADJ_RATE_CHANGE_is_EMPTY_freeform_dataset",
        "ruleType": "SQLF",
        "ruleValue": f"SELECT * FROM @{PULLUP_RULES_SQL_TYPES_DATASET} A "
                     f"where A.ADJ_RATE_CHANGE = ''",
        "points": 1,
        "perc": 1.0,
        "ruleRepo": "",
        "isActive": 1,
        "userNm": "autoadmin01@cdq-ad.dq.cp.collibra.dev",
        "exception": None,
        "columnName": "ADJ_RATE_CHANGE",
        "businessCategory": None,
        "businessDesc": None,
        "dimId": None,
        "dimName": None,
        "ruleValueBuilder": "condition,rules,not,valid",
        "previewLimit": 6,
        "runTimeLimit": 30.0,
        "scoringScheme": 0,
        "filterQuery": None,
        "tolerance": 0,
        "active": True
    },
    {
        "dataset": PULLUP_RULES_SQL_TYPES_DATASET,
        "ruleNm": "if_ADJ_RATE_CHANGE_is_EMPTY_simple",
        "ruleType": "SQLG",
        "ruleValue": "ADJ_RATE_CHANGE = ''",
        "points": 1,
        "perc": 1.0,
        "ruleRepo": "",
        "isActive": 1,
        "userNm": "autoadmin01@cdq-ad.dq.cp.collibra.dev",
        "exception": None,
        "columnName": "ADJ_RATE_CHANGE",
        "businessCategory": None,
        "businessDesc": None,
        "dimId": None,
        "dimName": None,
        "ruleValueBuilder": "condition,rules,not,valid",
        "previewLimit": 6,
        "runTimeLimit": 30.0,
        "scoringScheme": 0,
        "filterQuery": None,
        "tolerance": 0,
        "active": True
    },
    {
        "dataset": PULLUP_RULES_SQL_TYPES_DATASET,
        "ruleNm": "if_ADJ_RATE_CHANGE_is_NULLCHECK",
        "ruleType": "NULLCHECK",
        "ruleValue": "ADJ_RATE_CHANGE",
        "points": 1,
        "perc": 1.0,
        "ruleRepo": "",
        "isActive": 1,
        "userNm": "autoadmin01@cdq-ad.dq.cp.collibra.dev",
        "exception": None,
        "columnName": "ADJ_RATE_CHANGE",
        "businessCategory": None,
        "businessDesc": None,
        "dimId": None,
        "dimName": None,
        "ruleValueBuilder": None,
        "previewLimit": 6,
        "runTimeLimit": 30.0,
        "scoringScheme": 0,
        "filterQuery": None,
        "tolerance": 0,
        "active": True
    },
    {
        "dataset": PULLUP_RULES_SQL_TYPES_DATASET,
        "ruleNm": "if_ADJ_RATE_CHANGE_is_EMPTY_freeform",
        "ruleType": "SQLF",
        "ruleValue": f"SELECT * FROM @{PULLUP_RULES_SQL_TYPES_DATASET} A "
                     f"where A.ADJ_RATE_CHANGE = ''",
        "points": 1,
        "perc": 1.0,
        "ruleRepo": "",
        "isActive": 1,
        "userNm": "autoadmin01@cdq-ad.dq.cp.collibra.dev",
        "exception": None,
        "columnName": "ADJ_RATE_CHANGE",
        "businessCategory": None,
        "businessDesc": None,
        "dimId": None,
        "dimName": None,
        "ruleValueBuilder": "condition,rules,not,valid",
        "previewLimit": 6,
        "runTimeLimit": 30.0,
        "scoringScheme": 0,
        "filterQuery": None,
        "tolerance": 0,
        "active": True
    },
    {
        "dataset": PULLUP_RULES_SQL_TYPES_DATASET,
        "ruleNm": "if_ADJ_RATE_CHANGE_is_NULL_freeform",
        "ruleType": "SQLF",
        "ruleValue": f"SELECT * FROM @{PULLUP_RULES_SQL_TYPES_DATASET} "
                     f"WHERE ADJ_RATE_CHANGE IS NULL",
        "points": 1,
        "perc": 1.0,
        "ruleRepo": "",
        "isActive": 1,
        "userNm": "autoadmin01@cdq-ad.dq.cp.collibra.dev",
        "exception": None,
        "columnName": "ADJ_RATE_CHANGE",
        "businessCategory": None,
        "businessDesc": None,
        "dimId": None,
        "dimName": None,
        "ruleValueBuilder": "condition,rules,not,valid",
        "previewLimit": 6,
        "runTimeLimit": 30.0,
        "scoringScheme": 0,
        "filterQuery": None,
        "tolerance": 0,
        "active": True
    },
    {
        "dataset": PULLUP_RULES_SQL_TYPES_DATASET,
        "ruleNm": "if_ADJ_RATE_CHANGE_is_NULL_simple",
        "ruleType": "SQLG",
        "ruleValue": "ADJ_RATE_CHANGE is NULL",
        "points": 1,
        "perc": 1.0,
        "ruleRepo": "",
        "isActive": 1,
        "userNm": "autoadmin01@cdq-ad.dq.cp.collibra.dev",
        "exception": None,
        "columnName": "ADJ_RATE_CHANGE",
        "businessCategory": None,
        "businessDesc": None,
        "dimId": None,
        "dimName": None,
        "ruleValueBuilder": "condition,rules,not,valid",
        "previewLimit": 6,
        "runTimeLimit": 30.0,
        "scoringScheme": 0,
        "filterQuery": None,
        "tolerance": 0,
        "active": True
    },
    {
        "dataset": PULLUP_RULES_SQL_TYPES_DATASET,
        "ruleNm": "if_LOAD_DT_is_DATE_MM_DD_YYYY_freeform",
        "ruleType": "SQLF",
        "ruleValue": f"SELECT * from @{PULLUP_RULES_SQL_TYPES_DATASET} "
                     f"WHERE LOAD_DT not rlike '^\\d{1,2}/d{2}/d{4}$'",
        "points": 1,
        "perc": 1.0,
        "ruleRepo": "",
        "isActive": 1,
        "userNm": "autoadmin01@cdq-ad.dq.cp.collibra.dev",
        "exception": None,
        "columnName": "ADJ_RATE_CHANGE",
        "businessCategory": None,
        "businessDesc": None,
        "dimId": None,
        "dimName": None,
        "ruleValueBuilder": "condition,rules,not,valid",
        "previewLimit": 6,
        "runTimeLimit": 30.0,
        "scoringScheme": 0,
        "filterQuery": None,
        "tolerance": 0,
        "active": True
    },
    {
        "dataset": PULLUP_RULES_SQL_TYPES_DATASET,
        "ruleNm": "if_LOAD_DT_is_DATE_MM_DD_YYYY_simple",
        "ruleType": "SQLG",
        "ruleValue": "LOAD_DT not rlike '^%5x%5xd{1,2}/d{2}/d{4}$'",
        "points": 1,
        "perc": 1.0,
        "ruleRepo": "",
        "isActive": 1,
        "userNm": "autoadmin01@cdq-ad.dq.cp.collibra.dev",
        "exception": None,
        "columnName": "LOAD_DT",
        "businessCategory": None,
        "businessDesc": None,
        "dimId": None,
        "dimName": None,
        "ruleValueBuilder": "condition,rules,not,valid",
        "previewLimit": 6,
        "runTimeLimit": 30.0,
        "scoringScheme": 0,
        "filterQuery": None,
        "tolerance": 0,
        "active": True
    },
    {
        "dataset": PULLUP_RULES_SQL_TYPES_DATASET,
        "ruleNm": "if_POST_CD_NUM_is_ZIP_CODE",
        "ruleType": "CUSTOM",
        "ruleValue": "POST_CD_NUM",
        "points": 1,
        "perc": 1.0,
        "ruleRepo": "ZIP CODE",
        "isActive": 1,
        "userNm": "autoadmin01@cdq-ad.dq.cp.collibra.dev",
        "exception": None,
        "columnName": "POST_CD_NUM",
        "businessCategory": None,
        "businessDesc": None,
        "dimId": None,
        "dimName": None,
        "ruleValueBuilder": None,
        "previewLimit": 6,
        "runTimeLimit": 30.0,
        "scoringScheme": 0,
        "filterQuery": None,
        "tolerance": 0,
        "active": True
    },
    {
        "dataset": PULLUP_RULES_SQL_TYPES_DATASET,
        "ruleNm": "if_POST_CD_NUM_is_ZIP_CODE_freeform",
        "ruleType": "SQLF",
        "ruleValue": f"SELECT * FROM @{PULLUP_RULES_SQL_TYPES_DATASET} "
                     f"where POST_CD_NUM not rlike '^[0-9]{5}(?:-[0-9]{4})?$'",
        "points": 1,
        "perc": 1.0,
        "ruleRepo": "",
        "isActive": 1,
        "userNm": "autoadmin01@cdq-ad.dq.cp.collibra.dev",
        "exception": None,
        "columnName": "POST_CD_NUM",
        "businessCategory": None,
        "businessDesc": None,
        "dimId": None,
        "dimName": None,
        "ruleValueBuilder": "condition,rules,not,valid",
        "previewLimit": 6,
        "runTimeLimit": 30.0,
        "scoringScheme": 0,
        "filterQuery": None,
        "tolerance": 0,
        "active": True
    },
    {
        "dataset": PULLUP_RULES_SQL_TYPES_DATASET,
        "ruleNm": "if_POST_CD_NUM_is_ZIP_CODE_simple",
        "ruleType": "SQLG",
        "ruleValue": "POST_CD_NUM not rlike '^[0-9]{5}(?:-[0-9]{4})?$'",
        "points": 1,
        "perc": 1.0,
        "ruleRepo": "",
        "isActive": 1,
        "userNm": "autoadmin01@cdq-ad.dq.cp.collibra.dev",
        "exception": None,
        "columnName": "POST_CD_NUM",
        "businessCategory": None,
        "businessDesc": None,
        "dimId": None,
        "dimName": None,
        "ruleValueBuilder": "condition,rules,not,valid",
        "previewLimit": 6,
        "runTimeLimit": 30.0,
        "scoringScheme": 0,
        "filterQuery": None,
        "tolerance": 0,
        "active": True
    }
]
PULLUP_RULES_PWDMGR_ALL_RULE_TYPES_RULE_DEFINITIONS = [
    {
        "dataset": PULLUP_RULES_PWDMGR_ALL_RULE_TYPES_DATASET,
        "ruleNm": "ZipCode",
        "ruleType": "NATIVE",
        "ruleValue": "select * from public.aclaims_master_run where public.aclaims_master_run."
                     "\"Employee_AddressZipCode\" > 37709",
        "points": 1,
        "perc": 1.0,
        "ruleRepo": "",
        "isActive": 1,
        "userNm": None,
        "exception": None,
        "columnName": None,
        "businessCategory": "",
        "businessDesc": "",
        "dimId": None,
        "dimName": None,
        "ruleValueBuilder": None,
        "previewLimit": 6,
        "runTimeLimit": 30.0,
        "scoringScheme": 0,
        "filterQuery": None,
        "tolerance": 0,
        "active": True
    },
    {
        "dataset": PULLUP_RULES_PWDMGR_ALL_RULE_TYPES_DATASET,
        "ruleNm": "State",
        "ruleType": "SQLF",
        "ruleValue": f"SELECT * FROM @{PULLUP_RULES_PWDMGR_ALL_RULE_TYPES_DATASET} "
                     f"WHERE Employee_AddressState not IN (\"Tennessee\", \"Texas\")",
        "points": 1,
        "perc": 1.0,
        "ruleRepo": "",
        "isActive": 1,
        "userNm": None,
        "exception": None,
        "columnName": "Employee_AddressState",
        "businessCategory": "",
        "businessDesc": "",
        "dimId": None,
        "dimName": None,
        "ruleValueBuilder": None,
        "previewLimit": 6,
        "runTimeLimit": 30.0,
        "scoringScheme": 0,
        "filterQuery": None,
        "tolerance": 0,
        "active": True
    },
    {
        "dataset": PULLUP_RULES_PWDMGR_ALL_RULE_TYPES_DATASET,
        "ruleNm": "ReportDateNull",
        "ruleType": "NATIVE",
        "ruleValue": "select * from public.aclaims_master_run where public.aclaims_master_run."
                     "\"Report_Date\" is null",
        "points": 1,
        "perc": 1.0,
        "ruleRepo": "",
        "isActive": 1,
        "userNm": None,
        "exception": None,
        "columnName": None,
        "businessCategory": "",
        "businessDesc": "",
        "dimId": None,
        "dimName": None,
        "ruleValueBuilder": None,
        "previewLimit": 6,
        "runTimeLimit": 30.0,
        "scoringScheme": 0,
        "filterQuery": None,
        "tolerance": 0,
        "active": True
    },
    {
        "dataset": PULLUP_RULES_PWDMGR_ALL_RULE_TYPES_DATASET,
        "ruleNm": "if_Employee_SSN_is_SSN",
        "ruleType": "CUSTOM",
        "ruleValue": "Employee_SSN",
        "points": 1,
        "perc": 1.0,
        "ruleRepo": "SSN",
        "isActive": 1,
        "userNm": None,
        "exception": None,
        "columnName": "Employee_SSN",
        "businessCategory": "",
        "businessDesc": "",
        "dimId": None,
        "dimName": None,
        "ruleValueBuilder": None,
        "previewLimit": 6,
        "runTimeLimit": 30.0,
        "scoringScheme": 0,
        "filterQuery": None,
        "tolerance": 0,
        "active": True
    },
    {
        "dataset": PULLUP_RULES_PWDMGR_ALL_RULE_TYPES_DATASET,
        "ruleNm": "LeaveDate",
        "ruleType": "SQLG",
        "ruleValue": "Employee_LeaveDate IS NULL",
        "points": 1,
        "perc": 1.0,
        "ruleRepo": "",
        "isActive": 1,
        "userNm": None,
        "exception": None,
        "columnName": None,
        "businessCategory": "",
        "businessDesc": "",
        "dimId": None,
        "dimName": None,
        "ruleValueBuilder": None,
        "previewLimit": 6,
        "runTimeLimit": 30.0,
        "scoringScheme": 0,
        "filterQuery": None,
        "tolerance": 0,
        "active": True
    },
    {
        "dataset": PULLUP_RULES_PWDMGR_ALL_RULE_TYPES_DATASET,
        "ruleNm": "sqlf_regex",
        "ruleType": "SQLF",
        "ruleValue": f"SELECT * FROM @{PULLUP_RULES_PWDMGR_ALL_RULE_TYPES_DATASET} "
                     f"WHERE Employee_ContractPermanent like 'P%'",
        "points": 1,
        "perc": 1.0,
        "ruleRepo": "",
        "isActive": 1,
        "userNm": None,
        "exception": None,
        "columnName": None,
        "businessCategory": "",
        "businessDesc": "",
        "dimId": None,
        "dimName": None,
        "ruleValueBuilder": None,
        "previewLimit": 6,
        "runTimeLimit": 30.0,
        "scoringScheme": 0,
        "filterQuery": None,
        "tolerance": 0,
        "active": True
    },
    {
        "dataset": PULLUP_RULES_PWDMGR_ALL_RULE_TYPES_DATASET,
        "ruleNm": "native",
        "ruleType": "NATIVE",
        "ruleValue": "select * from public.aclaims_master_run WHERE public.aclaims_master_run."
                     "\"Employee_Division\" LIKE 'Sales%'",
        "points": 1,
        "perc": 1.0,
        "ruleRepo": "",
        "isActive": 1,
        "userNm": None,
        "exception": None,
        "columnName": None,
        "businessCategory": "",
        "businessDesc": "",
        "dimId": None,
        "dimName": None,
        "ruleValueBuilder": None,
        "previewLimit": 6,
        "runTimeLimit": 30.0,
        "scoringScheme": 0,
        "filterQuery": None,
        "tolerance": 0,
        "active": True
    }
]

PULLUP_RULES_SQL_TYPES_EXPECTED_RULE_OUTPUT = {
    "data": [
        {
            "dataset": PULLUP_RULES_SQL_TYPES_DATASET,
            "runId": "2024-11-14T00:00:00.000+0000",
            "ruleNm": "if_ADJ_RATE_CHANGE_is_EMPTY_freeform",
            "ruleType": "SQLF",
            "ruleValue": f"SELECT * FROM {PULLUP_RULES_SQL_TYPES_DATASET}_dataset A "
                         f"where A.ADJ_RATE_CHANGE = '' ",
            "filterQuery": None,
            "score": 0,
            "perc": 0.0,
            "exception": "",
            "owlId": "1",
            "breakMsg": "PASSING",
            "assignmentId": {
                "id": 449394,
                "uuid": "a74d3b67-c974-4afe-95d5-ba036cfb33a3"
            },
            "dimId": None,
            "dimName": None,
            "ruleCondition": f"SELECT * FROM @{PULLUP_RULES_SQL_TYPES_DATASET} A "
                             f"where A.ADJ_RATE_CHANGE = ''",
            "totalCount": 207,
            "rowsBreaking": 0,
            "tolerance": 0,
            "ruleStatus": "PASSING"
        },
        {
            "dataset": PULLUP_RULES_SQL_TYPES_DATASET,
            "runId": "2024-11-14T00:00:00.000+0000",
            "ruleNm": "if_ADJ_RATE_CHANGE_is_EMPTY_simple",
            "ruleType": "SQLG",
            "ruleValue": "ADJ_RATE_CHANGE = ''",
            "filterQuery": None,
            "score": 0,
            "perc": 0.0,
            "exception": "",
            "owlId": "1",
            "breakMsg": "PASSING",
            "assignmentId": {
                "id": 449398,
                "uuid": "a502eee2-66ee-4e8d-9f1c-1a2de2a98c6a"
            },
            "dimId": None,
            "dimName": None,
            "ruleCondition": "ADJ_RATE_CHANGE = ''",
            "totalCount": 207,
            "rowsBreaking": 0,
            "tolerance": 0,
            "ruleStatus": "PASSING"
        },
        {
            "dataset": PULLUP_RULES_SQL_TYPES_DATASET,
            "runId": "2024-11-14T00:00:00.000+0000",
            "ruleNm": "if_ADJ_RATE_CHANGE_is_NULL_freeform",
            "ruleType": "SQLF",
            "ruleValue": f"SELECT * FROM {PULLUP_RULES_SQL_TYPES_DATASET}_dataset "
                         f"WHERE ADJ_RATE_CHANGE IS NULL ",
            "filterQuery": None,
            "score": 28,
            "perc": 28.502416610717773,
            "exception": "",
            "owlId": "1",
            "breakMsg": "BREAKING",
            "assignmentId": {
                "id": 449401,
                "uuid": "da743a17-306a-42a8-b49a-b958f61e4171"
            },
            "dimId": None,
            "dimName": None,
            "ruleCondition": f"SELECT * FROM @{PULLUP_RULES_SQL_TYPES_DATASET} "
                             f"WHERE ADJ_RATE_CHANGE IS NULL",
            "totalCount": 207,
            "rowsBreaking": 59,
            "tolerance": 0,
            "ruleStatus": "BREAKING"
        },
        {
            "dataset": PULLUP_RULES_SQL_TYPES_DATASET,
            "runId": "2024-11-14T00:00:00.000+0000",
            "ruleNm": "if_LOAD_DT_is_DATE_MM_DD_YYYY_simple",
            "ruleType": "SQLG",
            "ruleValue": "LOAD_DT not rlike '^%5x%5xd{1,2}/d{2}/d{4}$'",
            "filterQuery": None,
            "score": 100,
            "perc": 100.0,
            "exception": "",
            "owlId": "1",
            "breakMsg": "BREAKING",
            "assignmentId": {
                "id": 449400,
                "uuid": "11dba86b-02ee-4b33-a5a6-0404c9bdbc62"
            },
            "dimId": None,
            "dimName": None,
            "ruleCondition": "LOAD_DT not rlike '^%5x%5xd{1,2}/d{2}/d{4}$'",
            "totalCount": 207,
            "rowsBreaking": 207,
            "tolerance": 0,
            "ruleStatus": "BREAKING"
        },
        {
            "dataset": PULLUP_RULES_SQL_TYPES_DATASET,
            "runId": "2024-11-14T00:00:00.000+0000",
            "ruleNm": "if_ADJ_RATE_CHANGE_is_EMPTY_freeform_dataset",
            "ruleType": "SQLF",
            "ruleValue": f"SELECT * FROM {PULLUP_RULES_SQL_TYPES_DATASET}_dataset A "
                         f"where A.ADJ_RATE_CHANGE = '' ",
            "filterQuery": None,
            "score": 0,
            "perc": 0.0,
            "exception": "",
            "owlId": "1",
            "breakMsg": "PASSING",
            "assignmentId": {
                "id": 449395,
                "uuid": "023e2162-54b8-481e-98a0-968a294d9cf4"
            },
            "dimId": None,
            "dimName": None,
            "ruleCondition": f"SELECT * FROM @{PULLUP_RULES_SQL_TYPES_DATASET} A "
                             f"where A.ADJ_RATE_CHANGE = ''",
            "totalCount": 207,
            "rowsBreaking": 0,
            "tolerance": 0,
            "ruleStatus": "PASSING"
        },
        {
            "dataset": PULLUP_RULES_SQL_TYPES_DATASET,
            "runId": "2024-11-14T00:00:00.000+0000",
            "ruleNm": "if_ADJ_RATE_CHANGE_is_NULLCHECK",
            "ruleType": "NULLCHECK",
            "ruleValue": "ADJ_RATE_CHANGE",
            "filterQuery": None,
            "score": 28,
            "perc": 28.502416610717773,
            "exception": "",
            "owlId": "1",
            "breakMsg": "BREAKING",
            "assignmentId": {
                "id": 449397,
                "uuid": "ef2ae19f-82e4-44f0-920c-5bd1c4ad9212"
            },
            "dimId": None,
            "dimName": None,
            "ruleCondition": "ADJ_RATE_CHANGE",
            "totalCount": 207,
            "rowsBreaking": 59,
            "tolerance": 0,
            "ruleStatus": "BREAKING"
        },
        {
            "dataset": PULLUP_RULES_SQL_TYPES_DATASET,
            "runId": "2024-11-14T00:00:00.000+0000",
            "ruleNm": "if_ADJ_RATE_CHANGE_is_EMPTYCHECK",
            "ruleType": "EMPTYCHECK",
            "ruleValue": "ADJ_RATE_CHANGE",
            "filterQuery": None,
            "score": 0,
            "perc": 0.0,
            "exception": "",
            "owlId": "1",
            "breakMsg": "PASSING",
            "assignmentId": {
                "id": 449396,
                "uuid": "438d6c0d-cf04-4896-b573-40cd33e5f4a9"
            },
            "dimId": None,
            "dimName": None,
            "ruleCondition": "ADJ_RATE_CHANGE",
            "totalCount": 207,
            "rowsBreaking": 0,
            "tolerance": 0,
            "ruleStatus": "PASSING"
        },
        {
            "dataset": PULLUP_RULES_SQL_TYPES_DATASET,
            "runId": "2024-11-14T00:00:00.000+0000",
            "ruleNm": "if_POST_CD_NUM_is_ZIP_CODE",
            "ruleType": "CUSTOM",
            "ruleValue": "POST_CD_NUM",
            "filterQuery": None,
            "score": 3,
            "perc": 3.864734247326851,
            "exception": "",
            "owlId": "1",
            "breakMsg": "BREAKING",
            "assignmentId": {
                "id": 449403,
                "uuid": "670dbb55-64c5-4935-a25a-042dde5cd8a9"
            },
            "dimId": None,
            "dimName": None,
            "ruleCondition": "POST_CD_NUM",
            "totalCount": 207,
            "rowsBreaking": 8,
            "tolerance": 0,
            "ruleStatus": "BREAKING"
        },
        {
            "dataset": PULLUP_RULES_SQL_TYPES_DATASET,
            "runId": "2024-11-14T00:00:00.000+0000",
            "ruleNm": "if_ADJ_RATE_CHANGE_is_NULL_simple",
            "ruleType": "SQLG",
            "ruleValue": "ADJ_RATE_CHANGE is NULL",
            "filterQuery": None,
            "score": 28,
            "perc": 28.502416610717773,
            "exception": "",
            "owlId": "1",
            "breakMsg": "BREAKING",
            "assignmentId": {
                "id": 449399,
                "uuid": "ed04b9b1-0f67-47ef-9eb8-6275e56169d0"
            },
            "dimId": None,
            "dimName": None,
            "ruleCondition": "ADJ_RATE_CHANGE is NULL",
            "totalCount": 207,
            "rowsBreaking": 59,
            "tolerance": 0,
            "ruleStatus": "BREAKING"
        },
        {
            "dataset": PULLUP_RULES_SQL_TYPES_DATASET,
            "runId": "2024-11-14T00:00:00.000+0000",
            "ruleNm": "if_LOAD_DT_is_DATE_MM_DD_YYYY_freeform",
            "ruleType": "SQLF",
            "ruleValue": f"SELECT * from {PULLUP_RULES_SQL_TYPES_DATASET}_dataset "
                         f"WHERE LOAD_DT not rlike '^\\d(1, 2)/d2/d4$' ",
            "filterQuery": None,
            "score": 100,
            "perc": 100.0,
            "exception": "",
            "owlId": "1",
            "breakMsg": "BREAKING",
            "assignmentId": {
                "id": 449402,
                "uuid": "49eb7025-3651-4302-b3a3-016f7d18cddc"
            },
            "dimId": None,
            "dimName": None,
            "ruleCondition": f"SELECT * from @{PULLUP_RULES_SQL_TYPES_DATASET} "
                             f"WHERE LOAD_DT not rlike '^\\d(1, 2)/d2/d4$'",
            "totalCount": 207,
            "rowsBreaking": 207,
            "tolerance": 0,
            "ruleStatus": "BREAKING"
        },
        {
            "dataset": PULLUP_RULES_SQL_TYPES_DATASET,
            "runId": "2024-11-14T00:00:00.000+0000",
            "ruleNm": "if_POST_CD_NUM_is_ZIP_CODE_simple",
            "ruleType": "SQLG",
            "ruleValue": "POST_CD_NUM not rlike '^[0-9]{5}(?:-[0-9]{4})?$'",
            "filterQuery": None,
            "score": 3,
            "perc": 3.864734247326851,
            "exception": "",
            "owlId": "1",
            "breakMsg": "BREAKING",
            "assignmentId": {
                "id": 449404,
                "uuid": "b3d4fc65-1875-4766-a380-b0a3063dbc6f"
            },
            "dimId": None,
            "dimName": None,
            "ruleCondition": "POST_CD_NUM not rlike '^[0-9]{5}(?:-[0-9]{4})?$'",
            "totalCount": 207,
            "rowsBreaking": 8,
            "tolerance": 0,
            "ruleStatus": "BREAKING"
        },
        {
            "dataset": PULLUP_RULES_SQL_TYPES_DATASET,
            "runId": "2024-11-14T00:00:00.000+0000",
            "ruleNm": "if_POST_CD_NUM_is_ZIP_CODE_freeform",
            "ruleType": "SQLF",
            "ruleValue": f"SELECT * FROM {PULLUP_RULES_SQL_TYPES_DATASET}_dataset "
                         f"where POST_CD_NUM not rlike '^[0-9]5(?:-[0-9]4)?$' ",
            "filterQuery": None,
            "score": 100,
            "perc": 100.0,
            "exception": "",
            "owlId": "1",
            "breakMsg": "BREAKING",
            "assignmentId": {
                "id": 449405,
                "uuid": "bf5550e0-d1d2-40b5-8236-ae48376c2a63"
            },
            "dimId": None,
            "dimName": None,
            "ruleCondition": f"SELECT * FROM @{PULLUP_RULES_SQL_TYPES_DATASET} "
                             f"where POST_CD_NUM not rlike '^[0-9]5(?:-[0-9]4)?$'",
            "totalCount": 207,
            "rowsBreaking": 207,
            "tolerance": 0,
            "ruleStatus": "BREAKING"
        }
    ]
}
PULLUP_RULES_PWDMGR_ALL_RULE_TYPES_EXPECTED_RULE_OUTPUT = {
    "data": [
        {
            "dataset": PULLUP_RULES_PWDMGR_ALL_RULE_TYPES_DATASET,
            "runId": "2021-12-15T00:00:00.000+0000",
            "ruleNm": "ZipCode",
            "ruleType": "NATIVE",
            "ruleValue": "select * from public.aclaims_master_run where public.aclaims_master_run."
                         "\"Employee_AddressZipCode\" > 37709",
            "filterQuery": None,
            "score": 61,
            "perc": 61.86550259590149,
            "exception": "",
            "owlId": "1",
            "breakMsg": "BREAKING",
            "assignmentId": {
                "id": 448945,
                "uuid": "027da4b0-15b8-4903-8656-f37af6406459"
            },
            "dimId": None,
            "dimName": None,
            "ruleCondition": "select * from public.aclaims_master_run "
                             "where public.aclaims_master_run.\"Employee_AddressZipCode\" > 37709",
            "totalCount": 13948,
            "rowsBreaking": 8629,
            "tolerance": 0,
            "ruleStatus": "BREAKING"
        },
        {
            "dataset": PULLUP_RULES_PWDMGR_ALL_RULE_TYPES_DATASET,
            "runId": "2021-12-15T00:00:00.000+0000",
            "ruleNm": "State",
            "ruleType": "SQLF",
            "ruleValue": f"SELECT * FROM {PULLUP_RULES_PWDMGR_ALL_RULE_TYPES_DATASET}_dataset "
                         f"WHERE Employee_AddressState not IN (\"Tennessee\", \"Texas\"  )  ",
            "filterQuery": None,
            "score": 89,
            "perc": 89.67593908309937,
            "exception": "",
            "owlId": "1",
            "breakMsg": "BREAKING",
            "assignmentId": {
                "id": 448950,
                "uuid": "dd286907-ef1a-409e-a932-689e23d17f4e"
            },
            "dimId": None,
            "dimName": None,
            "ruleCondition": f"SELECT * FROM @{PULLUP_RULES_PWDMGR_ALL_RULE_TYPES_DATASET} "
                             f"WHERE Employee_AddressState not IN (\"Tennessee\", \"Texas\")",
            "totalCount": 13948,
            "rowsBreaking": 12508,
            "tolerance": 0,
            "ruleStatus": "BREAKING"
        },
        {
            "dataset": PULLUP_RULES_PWDMGR_ALL_RULE_TYPES_DATASET,
            "runId": "2021-12-15T00:00:00.000+0000",
            "ruleNm": "sqlf_regex",
            "ruleType": "SQLF",
            "ruleValue": f"SELECT * FROM {PULLUP_RULES_PWDMGR_ALL_RULE_TYPES_DATASET}_dataset "
                         f"WHERE Employee_ContractPermanent like 'P%' ",
            "filterQuery": None,
            "score": 94,
            "perc": 94.63005661964417,
            "exception": "",
            "owlId": "1",
            "breakMsg": "BREAKING",
            "assignmentId": {
                "id": 448951,
                "uuid": "25fb09a8-51bb-4c4e-8f21-735c7e43c237"
            },
            "dimId": None,
            "dimName": None,
            "ruleCondition": f"SELECT * FROM @{PULLUP_RULES_PWDMGR_ALL_RULE_TYPES_DATASET} "
                             f"WHERE Employee_ContractPermanent like 'P%'",
            "totalCount": 13948,
            "rowsBreaking": 13199,
            "tolerance": 0,
            "ruleStatus": "BREAKING"
        },
        {
            "dataset": PULLUP_RULES_PWDMGR_ALL_RULE_TYPES_DATASET,
            "runId": "2021-12-15T00:00:00.000+0000",
            "ruleNm": "ReportDateNull",
            "ruleType": "NATIVE",
            "ruleValue": "select * from public.aclaims_master_run "
                         "where public.aclaims_master_run.\"Report_Date\" is null",
            "filterQuery": None,
            "score": 0,
            "perc": 0.0,
            "exception": "",
            "owlId": "1",
            "breakMsg": "PASSING",
            "assignmentId": {
                "id": 448946,
                "uuid": "174bf0f5-6564-4d9d-9d31-e831a432b646"
            },
            "dimId": None,
            "dimName": None,
            "ruleCondition": "select * from public.aclaims_master_run "
                             "where public.aclaims_master_run.\"Report_Date\" is null",
            "totalCount": 13948,
            "rowsBreaking": 0,
            "tolerance": 0,
            "ruleStatus": "PASSING"
        },
        {
            "dataset": PULLUP_RULES_PWDMGR_ALL_RULE_TYPES_DATASET,
            "runId": "2021-12-15T00:00:00.000+0000",
            "ruleNm": "native",
            "ruleType": "NATIVE",
            "ruleValue": "select * from public.aclaims_master_run "
                         "WHERE public.aclaims_master_run.\"Employee_Division\" LIKE 'Sales%'",
            "filterQuery": None,
            "score": 16,
            "perc": 16.79093837738037,
            "exception": "",
            "owlId": "1",
            "breakMsg": "BREAKING",
            "assignmentId": {
                "id": 448947,
                "uuid": "8a08e553-3dbe-4081-b5c7-8ed86c5058c1"
            },
            "dimId": None,
            "dimName": None,
            "ruleCondition": "select * from public.aclaims_master_run "
                             "WHERE public.aclaims_master_run.\"Employee_Division\" LIKE 'Sales%'",
            "totalCount": 13948,
            "rowsBreaking": 2342,
            "tolerance": 0,
            "ruleStatus": "BREAKING"
        },
        {
            "dataset": PULLUP_RULES_PWDMGR_ALL_RULE_TYPES_DATASET,
            "runId": "2021-12-15T00:00:00.000+0000",
            "ruleNm": "LeaveDate",
            "ruleType": "SQLG",
            "ruleValue": "Employee_LeaveDate IS NULL",
            "filterQuery": None,
            "score": 68,
            "perc": 68.19615960121155,
            "exception": "",
            "owlId": "1",
            "breakMsg": "BREAKING",
            "assignmentId": {
                "id": 448949,
                "uuid": "41323428-1b43-4c8b-a846-cfa046ebf41b"
            },
            "dimId": None,
            "dimName": None,
            "ruleCondition": "Employee_LeaveDate IS NULL",
            "totalCount": 13948,
            "rowsBreaking": 9512,
            "tolerance": 0,
            "ruleStatus": "BREAKING"
        },
        {
            "dataset": PULLUP_RULES_PWDMGR_ALL_RULE_TYPES_DATASET,
            "runId": "2021-12-15T00:00:00.000+0000",
            "ruleNm": "if_Employee_SSN_is_SSN",
            "ruleType": "CUSTOM",
            "ruleValue": "Employee_SSN",
            "filterQuery": None,
            "score": 100,
            "perc": 100.0,
            "exception": "",
            "owlId": "1",
            "breakMsg": "BREAKING",
            "assignmentId": {
                "id": 448948,
                "uuid": "b53a5b98-d86a-42bd-9b35-8822f9d8f2a8"
            },
            "dimId": None,
            "dimName": None,
            "ruleCondition": "Employee_SSN",
            "totalCount": 13948,
            "rowsBreaking": 13948,
            "tolerance": 0,
            "ruleStatus": "BREAKING"
        }
    ]
}

PULLUP_RULES_PWDMGR_ALL_RULE_TYPES_PAYLOAD = {
    "dataset": PULLUP_RULES_PWDMGR_ALL_RULE_TYPES_DATASET,
    "runId": WHERE_DATE_PWDMGR,
    "runIdEnd": "",
    "runState": "DRAFT",
    "passFail": 1,
    "passFailLimit": 75,
    "jobId": {"id": -1, "uuid": None},
    "coreMaxActiveConnections": None,
    "linkId": None,
    "licenseKey": "",
    "logFile": "",
    "logLevel": "INFO",
    "hootOnly": False,
    "prettyPrint": True,
    "useTemplate": False,
    "parallel": False,
    "plan": False,
    "dataPreviewOff": False,
    "datasetSafeOff": False,
    "obslimit": 300,
    "pgUser": "",
    "pgPassword": "",
    "host": "10.64.2.3:5432/rc202310?currentSchema=automation",
    "port": None,
    "user": "anonymous : use -owluser",
    "alertEmail": "",
    "scheduleTime": None,
    "schemaScore": 1,
    "optionAppend": PWD_CMD_LINE,
    "keyDelimiter": "~~",
    "agentId": {"id": 518, "uuid": "e77bc3eb-bc90-4f02-b005-9939fd24e3b2"},
    "load": {
        "readonly": False,
        "passwordManager": None,
        "alias": "",
        "query": "select * from public.aclaims_master_run",
        "queryHistory": "",
        "key": "",
        "expression": "",
        "addDateColumn": False,
        "zeroFillNull": False,
        "replaceNulls": "",
        "stringMode": False,
        "operator": "=",
        "dateColumn": "",
        "transform": "",
        "filter": "",
        "filterNot": "",
        "sample": 1,
        "backRun": 0,
        "backRunBin": "DAY",
        "unionLookBack": False,
        "unionLookBackMinRow": 0,
        "cache": True,
        "dateFormat": "yyyy-MM-dd",
        "timeFormat": "HH:mm:ss.SSS",
        "timestamp": False,
        "filePath": "",
        "fileQuery": "",
        "fullFile": False,
        "fileHeader": None,
        "inferSchema": True,
        "fileType": None,
        "delimiter": ",",
        "fileCharSet": "UTF-8",
        "skipLines": 0,
        "avroSchema": "",
        "xmlRowTag": "",
        "flatten": False,
        "handleMaps": False,
        "handleMixedJson": False,
        "multiLine": False,
        "lib": "/opt/owl/drivers/postgres/",
        "additionalLib": "",
        "driverName": "org.postgresql.Driver",
        "connectionName": CONN_NAME_PWDMGR,
        "connectionUrl": "jdbc:postgresql://35.190.143.55:5432/postgres",
        "userName": BASE_CREDS["username"],
        "password": "",
        "connectionProperties": {},
        "hiveNative": None,
        "hiveNativeHWC": False,
        "useSql": True,
        "columnName": None,
        "lowerBound": None,
        "upperBound": None,
        "numPartitions": 0,
        "partitionNumber": 0,
        "escapeWithBackTick": False,
        "escapeWithSingleQuote": False,
        "escapeWithDoubleQuote": False,
        "escapeCharacter": "",
        "checkHeader": True,
        "archiveBreakRecords": False,
        "archiveConnection": "",
    },
    "pushdown": {
        "connectionName": "",
        "maxConnections": 10,
        "sourceQuery": "",
        "backRuns": 0,
        "backRunBin": "DAY",
        "dateFormatType": "DATE",
        "threads": 5,
        "manualSourceQuery": False,
        "key": "",
        "sourceOutputSchema": "",
        "sourceBreakRules": False,
        "sourceBreakOutliers": False,
        "sourceBreakDupes": False,
        "sourceBreakShapes": False,
        "sqlLoggingToggle": True,
    },
    "outliers": [],
    "patterns": [],
    "dupe": {
        "on": False,
        "only": False,
        "include": None,
        "exclude": None,
        "depth": 0,
        "lowerBound": 99,
        "upperBound": 100,
        "approximate": 1,
        "limitPerDupe": 15,
        "checkHeader": True,
        "filter": None,
        "ignoreCase": True,
        "score": 1,
        "limit": 300,
    },
    "profile": {
        "on": True,
        "only": False,
        "include": [
            "Report_Date",
            "Employee_ID",
            "Employee_FirstName",
            "Employee_LastName",
            "Employee_Email",
            "Employee_AddressStreet",
            "Employee_AddressCity",
            "Employee_AddressState",
            "Employee_AddressZipCode",
            "Employee_SSN",
            "Employee_StartDate",
            "Employee_LeaveDate",
            "Employee_Status",
            "Employee_Office",
            "Employee_Division",
            "Employee_Department",
            "Employee_JobTitle",
            "Employee_JobLevel",
            "Employee_ContractPermanent",
            "Employee_Salary",
        ],
        "exclude": [],
        "shape": None,
        "correlation": None,
        "histogram": None,
        "semantic": None,
        "dataConceptId": 300,
        "limit": 300,
        "histogramLimit": 0,
        "score": 1,
        "shapeTotalScore": 0,
        "shapeSensitivity": 0,
        "shapeMaxPerCol": 20,
        "shapeMaxColSize": 12,
        "shapeGranular": None,
        "behavioralDimension": "",
        "behavioralDimensionGroup": "",
        "behavioralValueColumn": "",
        "behaviorScoreOff": False,
        "behaviorLookback": 10,
        "behaviorMinSupport": 4,
        "profilePushDown": None,
        "behaviorRowCheck": True,
        "behaviorTimeCheck": False,
        "behaviorMinValueCheck": False,
        "behaviorMaxValueCheck": False,
        "behaviorMeanValueCheck": False,
        "behaviorNullCheck": True,
        "behaviorEmptyCheck": True,
        "behaviorUniqueCheck": True,
        "profileStringLength": False,
        "detectStringNumerics": True,
        "detectTopnBotn": True,
        "detectScalePrecision": True,
        "adaptiveTier": None,
        "advancedTier": None,
    },
    "source": {
        "on": False,
        "only": False,
        "validateValues": False,
        "key": None,
        "include": None,
        "exclude": None,
        "includeSrc": None,
        "excludeSrc": None,
        "map": None,
        "score": 1,
        "limit": 30,
        "sourcePushDownCount": False,
        "checkType": True,
        "checkCase": False,
        "validateSchemaOrder": False,
        "matches": False,
        "validateValuesThreshold": 0.9,
        "validateValuesThresholdStrictDownScore": False,
        "validateValuesShowAll": False,
        "validateValuesIgnoreNull": False,
        "validateValuesIgnoreEmpty": False,
        "validateValuesIgnorePrecision": False,
        "validateValuesTrim": False,
        "validateValuesShowMissingKeys": False,
        "validateValuesFilter": "",
        "dataset": "",
        "driverName": "",
        "user": "",
        "password": "",
        "passwordManager": "",
        "connectionName": "",
        "connectionUrl": "",
        "query": "",
        "lib": "",
        "connectionProperties": {},
        "filePath": "",
        "fileQuery": "",
        "fullFile": False,
        "header": None,
        "skipLines": 0,
        "inferSchema": True,
        "fileType": None,
        "delimiter": ",",
        "fileCharSet": "UTF-8",
        "avroSchema": "",
        "xmlRowTag": "",
        "flatten": False,
        "handleMaps": False,
        "handleMixedJson": False,
        "multiLine": False,
        "filterCols": None,
    },
    "rule": {
        "on": True,
        "only": False,
        "lib": None,
        "name": "",
        "absoluteScoring": False,
        "ruleBreakPreviewLimit": 6,
    },
    "colMatch": {
        "colMatchParallelProcesses": 3,
        "colMatchDurationMins": 20,
        "colMatchBatchSize": 2,
        "level": "exact",
        "fuzzyDistance": 1,
        "connectionList": [],
    },
    "spark": {
        "numExecutors": 2,
        "driverMemory": "4g",
        "executorMemory": "6g",
        "executorCores": 1,
        "conf": "",
        "queue": "",
        "master": "k8s://",
        "principal": "",
        "keyTab": "",
        "deployMode": "cluster",
        "jars": None,
        "packages": None,
        "files": None,
    },
    "env": {"jdbcPrincipal": "", "jdbcKeyTab": ""},
    "record": {
        "on": False,
        "in": "",
        "notIn": "",
        "include": None,
        "percDeltaLimit": 0.1,
        "score": 1,
        "dataset": None,
        "dateColumn": None,
        "keyColumn": None,
        "timeBin": "DAY",
        "by": None,
    },
    "streamDefDTO": None,
    "pipeline": [],
}
